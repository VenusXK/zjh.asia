# 传输层背诵框架

[[TOC]]

## 传输层

### 功能

*和网络层的功能对比记忆*

- 进程间的逻辑通信
- 复用和分用
- 差错检验
- TCP和UDP

### 寻址

- 端口
- 端口号
- 套接字

### TCP和UDP

- 提供信道不同
- TCP不提供广播和组播，使用场合如FTP、HTTP、TELNET
- UDP在IP之上增加多路复用和错误检查，使用场合如TFTP、DNS、SNMP和RIP

---

- **UDP数据报和IP数据报的区别**：数据报是否对路由器可见
- **TCP数据报和虚电路的区别**
  - 数据报是否对路由器可见；
  - 网络层采用虚电路方式，则无法提供无连接服务
  - 传输层采用TCP不影响网络层提供无连接服务

## UDP

### 优点

- 无需建立连接
- 无连接状态
- 分组首部开销小
- 应用层更好地控制发送数据的内容和时机
- 支持一对一、一对多、多对一、多对多的交互通信
- 不保证可靠交付，但是可以通过在应用层增加控制机制来提高可靠性
- 面向报文，不合并也不拆分应用层报文

### 首部

| 0-15    | 16-31 |
| :----: | :----: |
| 源端口号(2B) | 目的端口号(2B) |
|  长度(2B)    |    校验和(2B) |

- 源端口：可选，不需要可全0
- 长度：最小值为8，单位为字节
- 校验和：可选，不需要可全0

### 分用

- 不存在对应端口号的进程，丢弃报文，ICMP发送“端口不可达”差错报文

### 校验

伪首部(不传递)

| 0-31    | 32-63 | 64-79 | 80-95 |
| :----: | :----: | :----: | :----: |
|源IP地址(4B) | 目的IP地址(4B) | 协议号(2B) | UDP长度(2B) |

---

步骤

1. 校验和设为全0
2. 视为若干个16位字块
3. 用0补全偶数个字节(不传递)
4. [反码运算](https://www.cnblogs.com/jcchan/p/10400504.html)计算16位块的和
5. 和写入校验和字段
6. 发送

---

特点

- 校验能力有限
- 简单、快速

---

注意

- **校验内容**：伪首部(源IP地址+目的IP地址)+UDP首部+数据部分
- **校验出错的做法**：1) 丢弃；2) 交付并通知上层；
- **和IP数据报的校验和不同**：IP数据报只校验首部，UDP数据报校验首部和数据
